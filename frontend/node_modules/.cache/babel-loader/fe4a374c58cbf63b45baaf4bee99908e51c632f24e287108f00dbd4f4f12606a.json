{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{useAuth}from'../../hooks/useAuth';import{socialMediaChannelsAPI}from'../../api/socialMediaChannels';import{ArrowLeft,RefreshCw,Users,MessageSquare,Send,Paperclip,X,Image as ImageIcon,Video,FileText,CheckCircle,XCircle,Trash2,Download,UserPlus,Building2}from'lucide-react';import toast from'react-hot-toast';import api from'../../utils/api';import{format}from'date-fns';import{AssignUsersModal}from'../../components/channels/AssignUsersModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChannelDetailOptimized=()=>{var _user$permissions,_user$permissions2;const{channelId}=useParams();const navigate=useNavigate();const{user,loading:authLoading}=useAuth();// State\nconst[channel,setChannel]=useState(null);const[messages,setMessages]=useState([]);const[loading,setLoading]=useState(true);const[showAssignUsersModal,setShowAssignUsersModal]=useState(false);const[assignedUsers,setAssignedUsers]=useState([]);// Message input\nconst[messageText,setMessageText]=useState('');const[mediaFiles,setMediaFiles]=useState([]);const[isSending,setIsSending]=useState(false);// Refs\nconst messagesEndRef=useRef(null);const pollIntervalRef=useRef(null);const fileInputRef=useRef(null);const lastMessageCountRef=useRef(0);// Scroll to bottom\nconst scrollToBottom=useCallback(()=>{setTimeout(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},100);},[]);// Load channel\nconst loadChannel=useCallback(async()=>{if(!channelId)return;try{const data=await socialMediaChannelsAPI.getChannel(Number(channelId));setChannel(data);}catch(error){toast.error('Kanal bilgileri yüklenemedi');navigate('/admin/social-media/channels');}},[channelId,navigate]);// Load assigned users\nconst loadAssignedUsers=useCallback(async()=>{if(!channelId)return;try{const response=await socialMediaChannelsAPI.getChannelAssignedUsers(Number(channelId));setAssignedUsers(response.assigned_users||[]);}catch(error){// Silently handle error - assigned users are not critical\n}},[channelId]);// Load messages\nconst loadMessages=useCallback(async function(){let silent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!channelId)return;try{if(!silent)setLoading(true);const response=await api.get(\"/api/social-media/channels/\".concat(channelId,\"/messages\"),{params:{per_page:500}});const fetchedMessages=response.data.messages||[];// Check for new messages\nconst hasNewMessages=fetchedMessages.length>lastMessageCountRef.current;lastMessageCountRef.current=fetchedMessages.length;setMessages(fetchedMessages);// Auto-scroll on new messages\nif(hasNewMessages){scrollToBottom();}}catch(error){if(!silent)toast.error('Mesajlar yüklenemedi');}finally{setLoading(false);}},[channelId,scrollToBottom]);// Initial load\nuseEffect(()=>{if(authLoading)return;if(!user){navigate('/login',{replace:true});return;}loadChannel();loadAssignedUsers();loadMessages();},[authLoading,user,navigate,loadChannel,loadAssignedUsers,loadMessages]);// Real-time polling (every 3 seconds)\nuseEffect(()=>{if(!channelId)return;pollIntervalRef.current=setInterval(()=>{loadMessages(true);},3000);return()=>{if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);}};},[channelId,loadMessages]);// File handling\nconst handleFileChange=e=>{if(!e.target.files)return;const files=Array.from(e.target.files);if(files.length+mediaFiles.length>50){toast.error('En fazla 50 dosya ekleyebilirsiniz');return;}setMediaFiles(prev=>[...prev,...files]);};const removeFile=index=>{setMediaFiles(prev=>prev.filter((_,i)=>i!==index));};const clearAllFiles=()=>{setMediaFiles([]);if(fileInputRef.current){fileInputRef.current.value='';}};// Send message\nconst handleSendMessage=async e=>{e.preventDefault();if(!channelId||!messageText.trim()&&mediaFiles.length===0)return;if(isSending)return;setIsSending(true);try{const textToSend=messageText.trim();const filesToSend=[...mediaFiles];// Clear inputs immediately for better UX\nsetMessageText('');clearAllFiles();// Send messages\nif(filesToSend.length>0){// Multiple files - send directly with FormData\nfor(let i=0;i<filesToSend.length;i++){const file=filesToSend[i];try{// Direkt FormData ile dosya gönder\nconst formData=new FormData();formData.append('file',file);formData.append('message_text',textToSend||file.name);// Yeni upload endpoint'ini kullan\nawait api.post(\"/api/social-media/channels/\".concat(channelId,\"/messages/upload\"),formData,{headers:{'Content-Type':'multipart/form-data'}});// Rate limiting için kısa bekleme\nif(i<filesToSend.length-1){await new Promise(resolve=>setTimeout(resolve,500));}}catch(error){toast.error(\"Dosya \".concat(i+1,\" g\\xF6nderilemedi: \").concat(file.name));}}toast.success(\"\".concat(filesToSend.length,\" dosya g\\xF6nderildi!\"));}else{// Text only\nawait api.post(\"/api/social-media/channels/\".concat(channelId,\"/messages\"),{message_text:textToSend,message_type:'text'});toast.success('Mesaj gönderildi!');}// Reload messages after 2 seconds\nsetTimeout(()=>loadMessages(true),2000);}catch(error){toast.error(error.message||'Mesaj gönderilemedi');}finally{setIsSending(false);}};// Sync from Telegram\nconst handleTelegramSync=async()=>{try{toast.loading('Telegram mesajları senkronize ediliyor...',{duration:2000});await api.post(\"/api/social-media/channels/\".concat(channelId,\"/sync-messages\"));toast.success('Mesajlar senkronize ediliyor');setTimeout(()=>loadMessages(true),3000);}catch(error){toast.error('Senkronizasyon başarısız');}};// Clear all messages\nconst handleClearMessages=async()=>{if(!window.confirm('Tüm mesajları silmek istediğinizden emin misiniz?'))return;try{toast.loading('Mesajlar temizleniyor...',{id:'clear'});const response=await api.delete(\"/api/social-media/channels/\".concat(channelId,\"/messages/clear\"));setMessages([]);lastMessageCountRef.current=0;toast.success(\"\\u2705 \".concat(response.data.deleted_count,\" mesaj temizlendi!\"),{id:'clear'});}catch(error){toast.error('Mesajlar temizlenemedi',{id:'clear'});}};// Render file icon\nconst renderFileIcon=type=>{if(type==='image')return/*#__PURE__*/_jsx(ImageIcon,{size:16,className:\"text-blue-500\"});if(type==='video')return/*#__PURE__*/_jsx(Video,{size:16,className:\"text-purple-500\"});return/*#__PURE__*/_jsx(FileText,{size:16,className:\"text-gray-500\"});};// Loading states\nif(authLoading||loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"})});}if(!channel)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-screen bg-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border-b border-gray-200 px-4 py-3\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/admin/social-media/channels'),className:\"p-2 hover:bg-gray-100 rounded-lg transition-colors\",children:/*#__PURE__*/_jsx(ArrowLeft,{size:20})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-lg font-semibold text-gray-900\",children:channel.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 text-xs text-gray-500\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:12}),messages.length,\" mesaj\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Users,{size:12}),channel.member_count||0,\" \\xFCye\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Building2,{size:12}),channel.brand_name||'Marka']}),channel.is_active?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1 text-green-600\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:12}),\"Aktif\"]}):/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1 text-red-600\",children:[/*#__PURE__*/_jsx(XCircle,{size:12}),\"Pasif\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[((user===null||user===void 0?void 0:(_user$permissions=user.permissions)===null||_user$permissions===void 0?void 0:_user$permissions.includes('social.manage'))||(user===null||user===void 0?void 0:(_user$permissions2=user.permissions)===null||_user$permissions2===void 0?void 0:_user$permissions2.includes('brands.manage')))&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowAssignUsersModal(true),className:\"flex items-center gap-2 px-3 py-1.5 text-sm bg-purple-50 text-purple-600 hover:bg-purple-100 rounded-lg transition-colors\",title:\"Kullan\\u0131c\\u0131 Y\\xF6net\",children:[/*#__PURE__*/_jsx(UserPlus,{size:14}),\"Kullan\\u0131c\\u0131 (\",assignedUsers.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleTelegramSync,className:\"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors\",title:\"Telegram'dan Mesajlar\\u0131 \\xC7ek\",children:[/*#__PURE__*/_jsx(RefreshCw,{size:14}),\"Sync\"]}),((user===null||user===void 0?void 0:user.role)==='Super Admin'||(user===null||user===void 0?void 0:user.role)==='Mağaza Yöneticisi')&&messages.length>0&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleClearMessages,className:\"flex items-center gap-2 px-3 py-1.5 text-sm bg-red-50 text-red-600 hover:bg-red-100 rounded-lg transition-colors\",title:\"T\\xFCm mesajlar\\u0131 temizle\",children:[/*#__PURE__*/_jsx(Trash2,{size:14}),\"Temizle\"]})]})]})}),assignedUsers.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 border-b border-gray-200 px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-600\",children:\"Atanan Kullan\\u0131c\\u0131lar:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-1\",children:assignedUsers.map(user=>/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 px-2 py-0.5 bg-white rounded-full border border-gray-200 text-xs text-gray-700\",children:[/*#__PURE__*/_jsx(Users,{size:10}),user.first_name,\" \",user.last_name]},user.id))})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto px-4 py-4 space-y-2\",children:[messages.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-full text-gray-400\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:48,className:\"mb-3\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"Hen\\xFCz mesaj yok\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs\",children:\"A\\u015Fa\\u011F\\u0131dan mesaj g\\xF6nderin\"})]}):messages.map(message=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(message.is_sent?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-[70%] rounded-lg px-3 py-2 \".concat(message.is_sent?'bg-blue-500 text-white':'bg-white border border-gray-200 text-gray-900',\" \").concat(message.is_sending?'opacity-50':''),children:[message.media_url&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[message.message_type==='image'&&/*#__PURE__*/_jsx(\"img\",{src:message.media_url,alt:message.file_name||'Image',className:\"max-w-full max-h-48 rounded cursor-pointer\",onClick:()=>window.open(message.media_url,'_blank')}),message.message_type==='video'&&/*#__PURE__*/_jsx(\"video\",{src:message.media_url,controls:true,className:\"max-w-full max-h-48 rounded\"}),message.message_type==='document'&&/*#__PURE__*/_jsxs(\"a\",{href:message.media_url,target:\"_blank\",rel:\"noopener noreferrer\",className:\"flex items-center gap-2 text-sm hover:underline\",children:[/*#__PURE__*/_jsx(Download,{size:14}),message.file_name||'Dosya']})]}),message.message_text&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm break-words\",children:message.message_text}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mt-1 \".concat(message.is_sent?'text-blue-100':'text-gray-400'),children:format(new Date(message.timestamp),'HH:mm')})]})},message.id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),mediaFiles.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-2 bg-gray-100 border-t border-gray-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 flex-wrap\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-600\",children:[mediaFiles.length,\" dosya:\"]}),mediaFiles.map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1 px-2 py-1 bg-white rounded border border-gray-300 text-xs\",children:[renderFileIcon(file.type.split('/')[0]),/*#__PURE__*/_jsx(\"span\",{className:\"max-w-[100px] truncate\",children:file.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFile(index),className:\"ml-1 text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(X,{size:12})})]},index)),/*#__PURE__*/_jsx(\"button\",{onClick:clearAllFiles,className:\"text-xs text-red-600 hover:text-red-700 underline\",children:\"T\\xFCm\\xFCn\\xFC Kald\\u0131r\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border-t border-gray-200 px-4 py-3\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"flex items-end gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",multiple:true,accept:\"image/*,video/*,.pdf,.doc,.docx,.txt\",onChange:handleFileChange,className:\"hidden\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},className:\"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors\",disabled:isSending,children:/*#__PURE__*/_jsx(Paperclip,{size:20})}),/*#__PURE__*/_jsx(\"textarea\",{value:messageText,onChange:e=>setMessageText(e.target.value),onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage(e);}},placeholder:\"Mesaj\\u0131n\\u0131z\\u0131 yaz\\u0131n...\",className:\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\",rows:1,disabled:isSending}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSending||!messageText.trim()&&mediaFiles.length===0,className:\"p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\",children:/*#__PURE__*/_jsx(Send,{size:20})})]})}),showAssignUsersModal&&channel&&user&&/*#__PURE__*/_jsx(AssignUsersModal,{channelId:channel.id,channelName:channel.name,brandId:channel.brand_id,currentAssignedUserIds:channel.assigned_user_ids||[],currentUserId:user.id,onClose:()=>setShowAssignUsersModal(false),onSuccess:()=>{loadAssignedUsers();loadChannel();}})]});};export default ChannelDetailOptimized;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useParams","useNavigate","useAuth","socialMediaChannelsAPI","ArrowLeft","RefreshCw","Users","MessageSquare","Send","Paperclip","X","Image","ImageIcon","Video","FileText","CheckCircle","XCircle","Trash2","Download","UserPlus","Building2","toast","api","format","AssignUsersModal","jsx","_jsx","jsxs","_jsxs","ChannelDetailOptimized","_user$permissions","_user$permissions2","channelId","navigate","user","loading","authLoading","channel","setChannel","messages","setMessages","setLoading","showAssignUsersModal","setShowAssignUsersModal","assignedUsers","setAssignedUsers","messageText","setMessageText","mediaFiles","setMediaFiles","isSending","setIsSending","messagesEndRef","pollIntervalRef","fileInputRef","lastMessageCountRef","scrollToBottom","setTimeout","_messagesEndRef$curre","current","scrollIntoView","behavior","loadChannel","data","getChannel","Number","error","loadAssignedUsers","response","getChannelAssignedUsers","assigned_users","loadMessages","silent","arguments","length","undefined","get","concat","params","per_page","fetchedMessages","hasNewMessages","replace","setInterval","clearInterval","handleFileChange","e","target","files","Array","from","prev","removeFile","index","filter","_","i","clearAllFiles","value","handleSendMessage","preventDefault","trim","textToSend","filesToSend","file","formData","FormData","append","name","post","headers","Promise","resolve","success","message_text","message_type","message","handleTelegramSync","duration","handleClearMessages","window","confirm","id","delete","deleted_count","renderFileIcon","type","size","className","children","onClick","member_count","brand_name","is_active","permissions","includes","title","role","map","first_name","last_name","is_sent","is_sending","media_url","src","alt","file_name","open","controls","href","rel","Date","timestamp","ref","split","onSubmit","multiple","accept","onChange","_fileInputRef$current","click","disabled","onKeyDown","key","shiftKey","placeholder","rows","channelName","brandId","brand_id","currentAssignedUserIds","assigned_user_ids","currentUserId","onClose","onSuccess"],"sources":["C:/Users/ilker/Desktop/aibrands/frontend/src/pages/admin/ChannelDetailOptimized.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../hooks/useAuth';\nimport { socialMediaChannelsAPI, SocialMediaChannel } from '../../api/socialMediaChannels';\nimport { \n  ArrowLeft, RefreshCw, Users, MessageSquare, Send, \n  Paperclip, X, Image as ImageIcon, Video, FileText, \n  CheckCircle, XCircle, Trash2, Download, UserPlus, \n  Building2\n} from 'lucide-react';\nimport toast from 'react-hot-toast';\nimport api from '../../utils/api';\nimport { format } from 'date-fns';\nimport { AssignUsersModal } from '../../components/channels/AssignUsersModal';\n\ninterface Message {\n  id: number;\n  message_text: string;\n  is_sent: boolean;\n  timestamp: string;\n  media_url?: string | null;\n  message_type?: string | null;\n  file_name?: string | null;\n  is_sending?: boolean;\n  temp_id?: number;\n}\n\nconst ChannelDetailOptimized: React.FC = () => {\n  const { channelId } = useParams<{ channelId: string }>();\n  const navigate = useNavigate();\n  const { user, loading: authLoading } = useAuth();\n  \n  // State\n  const [channel, setChannel] = useState<SocialMediaChannel | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showAssignUsersModal, setShowAssignUsersModal] = useState(false);\n  const [assignedUsers, setAssignedUsers] = useState<any[]>([]);\n  \n  // Message input\n  const [messageText, setMessageText] = useState('');\n  const [mediaFiles, setMediaFiles] = useState<File[]>([]);\n  const [isSending, setIsSending] = useState(false);\n  \n  // Refs\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const pollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const lastMessageCountRef = useRef<number>(0);\n\n  // Scroll to bottom\n  const scrollToBottom = useCallback(() => {\n    setTimeout(() => {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    }, 100);\n  }, []);\n\n  // Load channel\n  const loadChannel = useCallback(async () => {\n    if (!channelId) return;\n    \n    try {\n      const data = await socialMediaChannelsAPI.getChannel(Number(channelId));\n      setChannel(data);\n    } catch (error: any) {\n      toast.error('Kanal bilgileri yüklenemedi');\n      navigate('/admin/social-media/channels');\n    }\n  }, [channelId, navigate]);\n\n  // Load assigned users\n  const loadAssignedUsers = useCallback(async () => {\n    if (!channelId) return;\n    \n    try {\n      const response = await socialMediaChannelsAPI.getChannelAssignedUsers(Number(channelId));\n      setAssignedUsers(response.assigned_users || []);\n    } catch (error) {\n      // Silently handle error - assigned users are not critical\n    }\n  }, [channelId]);\n\n  // Load messages\n  const loadMessages = useCallback(async (silent = false) => {\n    if (!channelId) return;\n    \n    try {\n      if (!silent) setLoading(true);\n      \n      const response = await api.get(`/api/social-media/channels/${channelId}/messages`, {\n        params: { per_page: 500 }\n      });\n\n      const fetchedMessages: Message[] = response.data.messages || [];\n      \n      // Check for new messages\n      const hasNewMessages = fetchedMessages.length > lastMessageCountRef.current;\n      lastMessageCountRef.current = fetchedMessages.length;\n      \n      setMessages(fetchedMessages);\n      \n      // Auto-scroll on new messages\n      if (hasNewMessages) {\n        scrollToBottom();\n      }\n    } catch (error: any) {\n      if (!silent) toast.error('Mesajlar yüklenemedi');\n    } finally {\n      setLoading(false);\n    }\n  }, [channelId, scrollToBottom]);\n\n  // Initial load\n  useEffect(() => {\n    if (authLoading) return;\n    if (!user) {\n      navigate('/login', { replace: true });\n      return;\n    }\n    \n    loadChannel();\n    loadAssignedUsers();\n    loadMessages();\n  }, [authLoading, user, navigate, loadChannel, loadAssignedUsers, loadMessages]);\n\n  // Real-time polling (every 3 seconds)\n  useEffect(() => {\n    if (!channelId) return;\n    \n    pollIntervalRef.current = setInterval(() => {\n      loadMessages(true);\n    }, 3000);\n\n    return () => {\n      if (pollIntervalRef.current) {\n        clearInterval(pollIntervalRef.current);\n      }\n    };\n  }, [channelId, loadMessages]);\n\n  // File handling\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files) return;\n    \n    const files = Array.from(e.target.files);\n    if (files.length + mediaFiles.length > 50) {\n      toast.error('En fazla 50 dosya ekleyebilirsiniz');\n      return;\n    }\n\n    setMediaFiles(prev => [...prev, ...files]);\n  };\n\n  const removeFile = (index: number) => {\n    setMediaFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const clearAllFiles = () => {\n    setMediaFiles([]);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Send message\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!channelId || (!messageText.trim() && mediaFiles.length === 0)) return;\n    if (isSending) return;\n\n    setIsSending(true);\n\n    try {\n      const textToSend = messageText.trim();\n      const filesToSend = [...mediaFiles];\n      \n      // Clear inputs immediately for better UX\n      setMessageText('');\n      clearAllFiles();\n\n      // Send messages\n      if (filesToSend.length > 0) {\n        // Multiple files - send directly with FormData\n        for (let i = 0; i < filesToSend.length; i++) {\n          const file = filesToSend[i];\n          \n          try {\n            // Direkt FormData ile dosya gönder\n            const formData = new FormData();\n            formData.append('file', file);\n            formData.append('message_text', textToSend || file.name);\n            \n            // Yeni upload endpoint'ini kullan\n            await api.post(\n              `/api/social-media/channels/${channelId}/messages/upload`,\n              formData,\n              {\n                headers: { 'Content-Type': 'multipart/form-data' }\n              }\n            );\n            \n            // Rate limiting için kısa bekleme\n            if (i < filesToSend.length - 1) {\n              await new Promise(resolve => setTimeout(resolve, 500));\n            }\n            \n          } catch (error: any) {\n            toast.error(`Dosya ${i+1} gönderilemedi: ${file.name}`);\n          }\n        }\n        \n        toast.success(`${filesToSend.length} dosya gönderildi!`);\n      } else {\n        // Text only\n        await api.post(`/api/social-media/channels/${channelId}/messages`, {\n          message_text: textToSend,\n          message_type: 'text'\n        });\n        \n        toast.success('Mesaj gönderildi!');\n      }\n\n      // Reload messages after 2 seconds\n      setTimeout(() => loadMessages(true), 2000);\n\n    } catch (error: any) {\n      toast.error(error.message || 'Mesaj gönderilemedi');\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  // Sync from Telegram\n  const handleTelegramSync = async () => {\n    try {\n      toast.loading('Telegram mesajları senkronize ediliyor...', { duration: 2000 });\n      await api.post(`/api/social-media/channels/${channelId}/sync-messages`);\n      toast.success('Mesajlar senkronize ediliyor');\n      setTimeout(() => loadMessages(true), 3000);\n    } catch (error) {\n      toast.error('Senkronizasyon başarısız');\n    }\n  };\n\n  // Clear all messages\n  const handleClearMessages = async () => {\n    if (!window.confirm('Tüm mesajları silmek istediğinizden emin misiniz?')) return;\n    \n    try {\n      toast.loading('Mesajlar temizleniyor...', { id: 'clear' });\n      const response = await api.delete(`/api/social-media/channels/${channelId}/messages/clear`);\n      setMessages([]);\n      lastMessageCountRef.current = 0;\n      toast.success(`✅ ${response.data.deleted_count} mesaj temizlendi!`, { id: 'clear' });\n    } catch (error: any) {\n      toast.error('Mesajlar temizlenemedi', { id: 'clear' });\n    }\n  };\n\n  // Render file icon\n  const renderFileIcon = (type?: string | null) => {\n    if (type === 'image') return <ImageIcon size={16} className=\"text-blue-500\" />;\n    if (type === 'video') return <Video size={16} className=\"text-purple-500\" />;\n    return <FileText size={16} className=\"text-gray-500\" />;\n  };\n\n  // Loading states\n  if (authLoading || loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n      </div>\n    );\n  }\n\n  if (!channel) return null;\n\n  return (\n    <div className=\"flex flex-col h-screen bg-gray-50\">\n      {/* Header - Compact with Full Info */}\n      <div className=\"bg-white border-b border-gray-200 px-4 py-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={() => navigate('/admin/social-media/channels')}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <ArrowLeft size={20} />\n            </button>\n            \n            <div>\n              <h1 className=\"text-lg font-semibold text-gray-900\">{channel.name}</h1>\n              <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n                <span className=\"flex items-center gap-1\">\n                  <MessageSquare size={12} />\n                  {messages.length} mesaj\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <Users size={12} />\n                  {channel.member_count || 0} üye\n                </span>\n                <span className=\"flex items-center gap-1\">\n                  <Building2 size={12} />\n                  {channel.brand_name || 'Marka'}\n                </span>\n                {channel.is_active ? (\n                  <span className=\"flex items-center gap-1 text-green-600\">\n                    <CheckCircle size={12} />\n                    Aktif\n                  </span>\n                ) : (\n                  <span className=\"flex items-center gap-1 text-red-600\">\n                    <XCircle size={12} />\n                    Pasif\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            {(user?.permissions?.includes('social.manage') || user?.permissions?.includes('brands.manage')) && (\n              <button\n                onClick={() => setShowAssignUsersModal(true)}\n                className=\"flex items-center gap-2 px-3 py-1.5 text-sm bg-purple-50 text-purple-600 hover:bg-purple-100 rounded-lg transition-colors\"\n                title=\"Kullanıcı Yönet\"\n              >\n                <UserPlus size={14} />\n                Kullanıcı ({assignedUsers.length})\n              </button>\n            )}\n\n            <button\n              onClick={handleTelegramSync}\n              className=\"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors\"\n              title=\"Telegram'dan Mesajları Çek\"\n            >\n              <RefreshCw size={14} />\n              Sync\n            </button>\n\n            {(user?.role === 'Super Admin' || user?.role === 'Mağaza Yöneticisi') && messages.length > 0 && (\n              <button\n                onClick={handleClearMessages}\n                className=\"flex items-center gap-2 px-3 py-1.5 text-sm bg-red-50 text-red-600 hover:bg-red-100 rounded-lg transition-colors\"\n                title=\"Tüm mesajları temizle\"\n              >\n                <Trash2 size={14} />\n                Temizle\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Assigned Users Display */}\n      {assignedUsers.length > 0 && (\n        <div className=\"bg-gray-50 border-b border-gray-200 px-4 py-2\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-xs text-gray-600\">Atanan Kullanıcılar:</span>\n            <div className=\"flex flex-wrap gap-1\">\n              {assignedUsers.map((user: any) => (\n                <span\n                  key={user.id}\n                  className=\"inline-flex items-center gap-1 px-2 py-0.5 bg-white rounded-full border border-gray-200 text-xs text-gray-700\"\n                >\n                  <Users size={10} />\n                  {user.first_name} {user.last_name}\n                </span>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Messages Area - Minimal Design */}\n      <div className=\"flex-1 overflow-y-auto px-4 py-4 space-y-2\">\n        {messages.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\n            <MessageSquare size={48} className=\"mb-3\" />\n            <p className=\"text-sm\">Henüz mesaj yok</p>\n            <p className=\"text-xs\">Aşağıdan mesaj gönderin</p>\n          </div>\n        ) : (\n          messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex ${message.is_sent ? 'justify-end' : 'justify-start'}`}\n            >\n              <div\n                className={`max-w-[70%] rounded-lg px-3 py-2 ${\n                  message.is_sent\n                    ? 'bg-blue-500 text-white'\n                    : 'bg-white border border-gray-200 text-gray-900'\n                } ${message.is_sending ? 'opacity-50' : ''}`}\n              >\n                {/* Media */}\n                {message.media_url && (\n                  <div className=\"mb-2\">\n                    {message.message_type === 'image' && (\n                      <img\n                        src={message.media_url}\n                        alt={message.file_name || 'Image'}\n                        className=\"max-w-full max-h-48 rounded cursor-pointer\"\n                        onClick={() => window.open(message.media_url!, '_blank')}\n                      />\n                    )}\n                    {message.message_type === 'video' && (\n                      <video\n                        src={message.media_url}\n                        controls\n                        className=\"max-w-full max-h-48 rounded\"\n                      />\n                    )}\n                    {message.message_type === 'document' && (\n                      <a\n                        href={message.media_url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"flex items-center gap-2 text-sm hover:underline\"\n                      >\n                        <Download size={14} />\n                        {message.file_name || 'Dosya'}\n                      </a>\n                    )}\n                  </div>\n                )}\n\n                {/* Text */}\n                {message.message_text && (\n                  <p className=\"text-sm break-words\">{message.message_text}</p>\n                )}\n\n                {/* Timestamp */}\n                <div className={`text-xs mt-1 ${message.is_sent ? 'text-blue-100' : 'text-gray-400'}`}>\n                  {format(new Date(message.timestamp), 'HH:mm')}\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* File Previews - Minimal */}\n      {mediaFiles.length > 0 && (\n        <div className=\"px-4 py-2 bg-gray-100 border-t border-gray-200\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <span className=\"text-xs text-gray-600\">{mediaFiles.length} dosya:</span>\n            {mediaFiles.map((file, index) => (\n              <div\n                key={index}\n                className=\"flex items-center gap-1 px-2 py-1 bg-white rounded border border-gray-300 text-xs\"\n              >\n                {renderFileIcon(file.type.split('/')[0])}\n                <span className=\"max-w-[100px] truncate\">{file.name}</span>\n                <button\n                  onClick={() => removeFile(index)}\n                  className=\"ml-1 text-red-500 hover:text-red-700\"\n                >\n                  <X size={12} />\n                </button>\n              </div>\n            ))}\n            <button\n              onClick={clearAllFiles}\n              className=\"text-xs text-red-600 hover:text-red-700 underline\"\n            >\n              Tümünü Kaldır\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Input Area - Compact */}\n      <div className=\"bg-white border-t border-gray-200 px-4 py-3\">\n        <form onSubmit={handleSendMessage} className=\"flex items-end gap-2\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            accept=\"image/*,video/*,.pdf,.doc,.docx,.txt\"\n            onChange={handleFileChange}\n            className=\"hidden\"\n          />\n\n          <button\n            type=\"button\"\n            onClick={() => fileInputRef.current?.click()}\n            className=\"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors\"\n            disabled={isSending}\n          >\n            <Paperclip size={20} />\n          </button>\n\n          <textarea\n            value={messageText}\n            onChange={(e) => setMessageText(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSendMessage(e);\n              }\n            }}\n            placeholder=\"Mesajınızı yazın...\"\n            className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n            rows={1}\n            disabled={isSending}\n          />\n\n          <button\n            type=\"submit\"\n            disabled={isSending || (!messageText.trim() && mediaFiles.length === 0)}\n            className=\"p-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <Send size={20} />\n          </button>\n        </form>\n      </div>\n\n      {/* Assign Users Modal */}\n      {showAssignUsersModal && channel && user && (\n        <AssignUsersModal\n          channelId={channel.id}\n          channelName={channel.name}\n          brandId={channel.brand_id}\n          currentAssignedUserIds={channel.assigned_user_ids || []}\n          currentUserId={user.id}\n          onClose={() => setShowAssignUsersModal(false)}\n          onSuccess={() => {\n            loadAssignedUsers();\n            loadChannel();\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ChannelDetailOptimized;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}