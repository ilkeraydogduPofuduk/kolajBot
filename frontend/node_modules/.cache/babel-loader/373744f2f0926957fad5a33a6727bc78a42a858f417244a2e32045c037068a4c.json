{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{useAuth}from'../../hooks/useAuth';import{socialMediaChannelsAPI}from'../../api/socialMediaChannels';import{ArrowLeft,RefreshCw,Users,MessageSquare,Send,Paperclip,X,Image as ImageIcon,Video,FileText,CheckCircle,XCircle,Trash2,Download,UserPlus,Building2,BarChart3,TrendingUp,Bot}from'lucide-react';import toast from'react-hot-toast';import api from'../../utils/api';import{format}from'date-fns';import{AssignUsersModal}from'../../components/channels/AssignUsersModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChannelDetailOptimized=()=>{var _user$permissions,_user$permissions2;const{channelId}=useParams();const navigate=useNavigate();const{user,loading:authLoading}=useAuth();// State\nconst[channel,setChannel]=useState(null);const[messages,setMessages]=useState([]);const[loading,setLoading]=useState(true);const[showAssignUsersModal,setShowAssignUsersModal]=useState(false);const[assignedUsers,setAssignedUsers]=useState([]);const[statistics,setStatistics]=useState(null);const[botInfo,setBotInfo]=useState(null);const[assignedUsersStats,setAssignedUsersStats]=useState([]);const[showStats,setShowStats]=useState(true);// Message input\nconst[messageText,setMessageText]=useState('');const[mediaFiles,setMediaFiles]=useState([]);const[isSending,setIsSending]=useState(false);// Refs\nconst messagesEndRef=useRef(null);const pollIntervalRef=useRef(null);const fileInputRef=useRef(null);const lastMessageCountRef=useRef(0);// Scroll to bottom\nconst scrollToBottom=useCallback(()=>{setTimeout(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},100);},[]);// Load channel\nconst loadChannel=useCallback(async()=>{if(!channelId)return;try{const data=await socialMediaChannelsAPI.getChannel(Number(channelId));setChannel(data);}catch(error){toast.error('Kanal bilgileri yüklenemedi');navigate('/admin/social-media/channels');}},[channelId,navigate]);// Load assigned users\nconst loadAssignedUsers=useCallback(async()=>{if(!channelId)return;try{const response=await socialMediaChannelsAPI.getChannelAssignedUsers(Number(channelId));setAssignedUsers(response.assigned_users||[]);}catch(error){// Silently handle error - assigned users are not critical\n}},[channelId]);// Load statistics\nconst loadStatistics=useCallback(async()=>{if(!channelId)return;try{const response=await api.get(\"/api/social-media/channels/\".concat(channelId,\"/statistics\"));setStatistics(response.data.statistics);setBotInfo(response.data.bot);setAssignedUsersStats(response.data.assigned_users||[]);}catch(error){console.error('Statistics load error:',error);}},[channelId]);// Load messages\nconst loadMessages=useCallback(async function(){let silent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!channelId)return;try{if(!silent)setLoading(true);const response=await api.get(\"/api/social-media/channels/\".concat(channelId,\"/messages\"),{params:{per_page:500}});const fetchedMessages=response.data.messages||[];// Check for new messages\nconst hasNewMessages=fetchedMessages.length>lastMessageCountRef.current;lastMessageCountRef.current=fetchedMessages.length;setMessages(fetchedMessages);// Auto-scroll on new messages\nif(hasNewMessages){scrollToBottom();}}catch(error){if(!silent)toast.error('Mesajlar yüklenemedi');}finally{setLoading(false);}},[channelId,scrollToBottom]);// Initial load\nuseEffect(()=>{if(authLoading)return;if(!user){navigate('/login',{replace:true});return;}loadChannel();loadAssignedUsers();loadMessages();loadStatistics();},[authLoading,user,navigate,loadChannel,loadAssignedUsers,loadMessages,loadStatistics]);// Real-time polling (every 3 seconds)\nuseEffect(()=>{if(!channelId)return;pollIntervalRef.current=setInterval(()=>{loadMessages(true);},3000);return()=>{if(pollIntervalRef.current){clearInterval(pollIntervalRef.current);}};},[channelId,loadMessages]);// File handling\nconst handleFileChange=e=>{if(!e.target.files)return;const files=Array.from(e.target.files);// Dosya sayısı kontrolü\nif(files.length+mediaFiles.length>50){toast.error('En fazla 50 dosya ekleyebilirsiniz');return;}// Dosya boyutu kontrolü (her dosya max 50MB)\nconst maxSize=50*1024*1024;// 50MB\nconst oversizedFiles=files.filter(f=>f.size>maxSize);if(oversizedFiles.length>0){toast.error(\"Baz\\u0131 dosyalar \\xE7ok b\\xFCy\\xFCk (max 50MB): \".concat(oversizedFiles.map(f=>f.name).join(', ')));return;}setMediaFiles(prev=>[...prev,...files]);toast.success(\"\".concat(files.length,\" dosya eklendi\"));};const removeFile=index=>{setMediaFiles(prev=>prev.filter((_,i)=>i!==index));};const clearAllFiles=()=>{setMediaFiles([]);if(fileInputRef.current){fileInputRef.current.value='';}};// Send message - TAM ÇALIŞIR VERSİYON\nconst handleSendMessage=async e=>{e.preventDefault();// Validasyon\nif(!channelId){toast.error('Kanal ID bulunamadı');return;}if(!messageText.trim()&&mediaFiles.length===0){toast.error('Lütfen mesaj yazın veya dosya ekleyin');return;}if(isSending)return;setIsSending(true);const textToSend=messageText.trim();const filesToSend=[...mediaFiles];// Clear inputs immediately for better UX\nsetMessageText('');clearAllFiles();try{// SENARYO 1: Sadece metin (dosya yok)\nif(filesToSend.length===0&&textToSend){await api.post(\"/api/social-media/channels/\".concat(channelId,\"/messages\"),{message_text:textToSend,message_type:'text'});toast.success('✅ Mesaj gönderildi!');}// SENARYO 2: Tek dosya + metin (opsiyonel)\nelse if(filesToSend.length===1){const file=filesToSend[0];const formData=new FormData();formData.append('file',file);if(textToSend){formData.append('message_text',textToSend);}await api.post(\"/api/social-media/channels/\".concat(channelId,\"/messages/upload\"),formData,{headers:{'Content-Type':'multipart/form-data'}});toast.success(\"\\u2705 \".concat(textToSend?'Mesaj ve dosya':'Dosya',\" g\\xF6nderildi!\"));}// SENARYO 3: Çoklu dosya + metin (opsiyonel)\nelse if(filesToSend.length>1){let successCount=0;let failCount=0;// İlk dosyaya metni ekle\nfor(let i=0;i<filesToSend.length;i++){const file=filesToSend[i];try{const formData=new FormData();formData.append('file',file);// Sadece ilk dosyaya metin ekle\nif(i===0&&textToSend){formData.append('message_text',textToSend);}await api.post(\"/api/social-media/channels/\".concat(channelId,\"/messages/upload\"),formData,{headers:{'Content-Type':'multipart/form-data'}});successCount++;// Rate limiting: Her dosya arasında 500ms bekle\nif(i<filesToSend.length-1){await new Promise(resolve=>setTimeout(resolve,500));}}catch(error){failCount++;console.error(\"Dosya g\\xF6nderimi ba\\u015Far\\u0131s\\u0131z: \".concat(file.name),error);toast.error(\"\\u274C \".concat(file.name,\" g\\xF6nderilemedi\"),{duration:2000});}}// Özet mesaj\nif(successCount>0){toast.success(\"\\u2705 \".concat(successCount,\"/\").concat(filesToSend.length,\" dosya g\\xF6nderildi!\"));}if(failCount>0){toast.error(\"\\u26A0\\uFE0F \".concat(failCount,\" dosya g\\xF6nderilemedi\"));}}// Mesajları yenile\nsetTimeout(()=>{loadMessages(true);scrollToBottom();},2000);}catch(error){var _error$response,_error$response$data;console.error('Mesaj gönderme hatası:',error);const errorMessage=(error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||error.message||'Mesaj gönderilemedi';toast.error(\"\\u274C \".concat(errorMessage));// Hata durumunda girişleri geri yükle\nif(textToSend)setMessageText(textToSend);if(filesToSend.length>0)setMediaFiles(filesToSend);}finally{setIsSending(false);}};// Sync from Telegram\nconst handleTelegramSync=async()=>{try{toast.loading('Telegram mesajları senkronize ediliyor...',{duration:2000});await api.post(\"/api/social-media/channels/\".concat(channelId,\"/sync-messages\"));toast.success('Mesajlar senkronize ediliyor');setTimeout(()=>loadMessages(true),3000);}catch(error){toast.error('Senkronizasyon başarısız');}};// Clear all messages\nconst handleClearMessages=async()=>{if(!window.confirm('Tüm mesajları silmek istediğinizden emin misiniz?'))return;try{toast.loading('Mesajlar temizleniyor...',{id:'clear'});const response=await api.delete(\"/api/social-media/channels/\".concat(channelId,\"/messages/clear\"));setMessages([]);lastMessageCountRef.current=0;toast.success(\"\\u2705 \".concat(response.data.deleted_count,\" mesaj temizlendi!\"),{id:'clear'});}catch(error){toast.error('Mesajlar temizlenemedi',{id:'clear'});}};// Render file icon\nconst renderFileIcon=type=>{if(type==='image')return/*#__PURE__*/_jsx(ImageIcon,{size:16,className:\"text-blue-500\"});if(type==='video')return/*#__PURE__*/_jsx(Video,{size:16,className:\"text-purple-500\"});return/*#__PURE__*/_jsx(FileText,{size:16,className:\"text-gray-500\"});};// Loading states\nif(authLoading||loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"})});}if(!channel)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 shadow-sm\",children:/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/admin/telegram/channels'),className:\"p-2.5 hover:bg-gray-100 rounded-xl transition-all hover:shadow-md group\",title:\"Geri D\\xF6n\",children:/*#__PURE__*/_jsx(ArrowLeft,{size:22,className:\"group-hover:-translate-x-0.5 transition-transform\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold text-gray-900\",children:channel.name}),channel.is_active?/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:14}),\"Aktif\"]}):/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium\",children:[/*#__PURE__*/_jsx(XCircle,{size:14}),\"Pasif\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 mt-1.5\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1.5 text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:14,className:\"text-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:messages.length}),\" mesaj\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1.5 text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(Users,{size:14,className:\"text-purple-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:channel.member_count||0}),\" \\xFCye\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1.5 text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(Building2,{size:14,className:\"text-indigo-500\"}),channel.brand_name||'Marka']})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowStats(!showStats),className:\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium rounded-xl transition-all shadow-sm \".concat(showStats?'bg-gradient-to-r from-indigo-500 to-indigo-600 text-white shadow-indigo-200':'bg-white text-gray-700 hover:bg-gray-50 border border-gray-200'),title:\"\\u0130statistikleri G\\xF6ster/Gizle\",children:[/*#__PURE__*/_jsx(BarChart3,{size:16}),\"\\u0130statistikler\"]}),((user===null||user===void 0?void 0:(_user$permissions=user.permissions)===null||_user$permissions===void 0?void 0:_user$permissions.includes('social.manage'))||(user===null||user===void 0?void 0:(_user$permissions2=user.permissions)===null||_user$permissions2===void 0?void 0:_user$permissions2.includes('brands.manage')))&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowAssignUsersModal(true),className:\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl hover:from-purple-600 hover:to-purple-700 transition-all shadow-sm shadow-purple-200\",title:\"Kullan\\u0131c\\u0131 Y\\xF6net\",children:[/*#__PURE__*/_jsx(UserPlus,{size:16}),\"Kullan\\u0131c\\u0131 (\",assignedUsers.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleTelegramSync,className:\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium bg-white text-blue-600 border border-blue-200 rounded-xl hover:bg-blue-50 transition-all shadow-sm\",title:\"Telegram'dan Mesajlar\\u0131 \\xC7ek\",children:[/*#__PURE__*/_jsx(RefreshCw,{size:16}),\"Sync\"]}),((user===null||user===void 0?void 0:user.role)==='Super Admin'||(user===null||user===void 0?void 0:user.role)==='Mağaza Yöneticisi')&&messages.length>0&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleClearMessages,className:\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium bg-white text-red-600 border border-red-200 rounded-xl hover:bg-red-50 transition-all shadow-sm\",title:\"T\\xFCm mesajlar\\u0131 temizle\",children:[/*#__PURE__*/_jsx(Trash2,{size:16}),\"Temizle\"]})]})]})})}),showStats&&statistics&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border-b border-gray-200 px-4 py-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-4 gap-4 mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl border border-blue-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs font-medium text-blue-600 mb-1\",children:\"Toplam Mesaj\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-blue-900\",children:statistics.total_messages})]}),/*#__PURE__*/_jsx(MessageSquare,{className:\"text-blue-500\",size:32})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl border border-green-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs font-medium text-green-600 mb-1\",children:\"G\\xF6nderilen Post\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-green-900\",children:statistics.sent_posts})]}),/*#__PURE__*/_jsx(Send,{className:\"text-green-500\",size:32})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl border border-purple-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs font-medium text-purple-600 mb-1\",children:\"Toplam \\xDCye\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-purple-900\",children:statistics.total_members})]}),/*#__PURE__*/_jsx(Users,{className:\"text-purple-500\",size:32})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-xl border border-orange-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-xs font-medium text-orange-600 mb-1\",children:\"Atanm\\u0131\\u015F \\xC7al\\u0131\\u015Fan\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-orange-900\",children:statistics.assigned_users_count})]}),/*#__PURE__*/_jsx(UserPlus,{className:\"text-orange-500\",size:32})]})})]}),botInfo&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-br from-indigo-50 to-indigo-100 p-4 rounded-xl border border-indigo-200 mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(Bot,{className:\"text-indigo-600\",size:28}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-semibold text-indigo-900\",children:botInfo.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-indigo-600\",children:botInfo.username})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[botInfo.is_active&&/*#__PURE__*/_jsxs(\"span\",{className:\"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full flex items-center gap-1\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:12}),\"Aktif\"]}),botInfo.is_verified&&/*#__PURE__*/_jsxs(\"span\",{className:\"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full flex items-center gap-1\",children:[/*#__PURE__*/_jsx(CheckCircle,{size:12}),\"Do\\u011Frulanm\\u0131\\u015F\"]})]})]})}),assignedUsersStats.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-xl border border-gray-200 overflow-hidden\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 px-4 py-3 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"h3\",{className:\"text-sm font-semibold text-gray-900 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(TrendingUp,{size:16,className:\"text-gray-600\"}),\"\\xC7al\\u0131\\u015Fan Performans\\u0131\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-600\",children:\"\\xC7al\\u0131\\u015Fan\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium text-gray-600\",children:\"Email\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-right text-xs font-medium text-gray-600\",children:\"G\\xF6nderilen Post\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-gray-200\",children:assignedUsersStats.map(userStat=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50 transition-colors\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 text-sm text-gray-900 font-medium\",children:userStat.name}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 text-sm text-gray-600\",children:userStat.email}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 text-sm text-right\",children:/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center justify-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full font-semibold\",children:userStat.sent_messages})})]},userStat.id))})]})})]})]}),assignedUsers.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 border-b border-gray-200 px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-600\",children:\"Atanan Kullan\\u0131c\\u0131lar:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-1\",children:assignedUsers.map(user=>/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 px-2 py-0.5 bg-white rounded-full border border-gray-200 text-xs text-gray-700\",children:[/*#__PURE__*/_jsx(Users,{size:10}),user.first_name,\" \",user.last_name]},user.id))})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto px-6 py-6 space-y-3\",children:[messages.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center justify-center h-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl shadow-sm\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:56,className:\"mb-4 text-blue-400 mx-auto\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-base font-medium text-gray-700 mb-1\",children:\"Hen\\xFCz mesaj yok\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"A\\u015Fa\\u011F\\u0131dan ilk mesaj\\u0131n\\u0131z\\u0131 g\\xF6nderin\"})]})}):messages.map(message=>/*#__PURE__*/_jsx(\"div\",{className:\"flex \".concat(message.is_sent?'justify-end':'justify-start',\" animate-fadeIn\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-[70%] rounded-2xl px-4 py-3 shadow-sm \".concat(message.is_sent?'bg-gradient-to-r from-blue-500 to-blue-600 text-white':'bg-white border border-gray-200 text-gray-900',\" \").concat(message.is_sending?'opacity-60 animate-pulse':''),children:[message.media_url&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[message.message_type==='image'&&/*#__PURE__*/_jsx(\"img\",{src:message.media_url,alt:message.file_name||'Image',className:\"max-w-full max-h-64 rounded-xl cursor-pointer hover:opacity-90 transition-opacity\",onClick:()=>window.open(message.media_url,'_blank')}),message.message_type==='video'&&/*#__PURE__*/_jsx(\"video\",{src:message.media_url,controls:true,className:\"max-w-full max-h-64 rounded-xl\"}),message.message_type==='document'&&/*#__PURE__*/_jsxs(\"a\",{href:message.media_url,target:\"_blank\",rel:\"noopener noreferrer\",className:\"flex items-center gap-2 text-sm hover:underline\",children:[/*#__PURE__*/_jsx(Download,{size:14}),message.file_name||'Dosya']})]}),message.message_text&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm break-words\",children:message.message_text}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs mt-1 \".concat(message.is_sent?'text-blue-100':'text-gray-400'),children:format(new Date(message.timestamp),'HH:mm')})]})},message.id)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),mediaFiles.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-t border-blue-100\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Paperclip,{size:16,className:\"text-blue-600\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-blue-900\",children:[mediaFiles.length,\" dosya se\\xE7ildi\"]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:clearAllFiles,className:\"text-xs text-red-600 hover:text-red-700 font-medium flex items-center gap-1 hover:underline\",children:[/*#__PURE__*/_jsx(X,{size:14}),\"T\\xFCm\\xFCn\\xFC Kald\\u0131r\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2 flex-wrap\",children:mediaFiles.map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"group relative flex items-center gap-2 px-3 py-2 bg-white rounded-lg border border-blue-200 shadow-sm hover:shadow-md transition-all\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-1.5 bg-blue-100 rounded\",children:renderFileIcon(file.type.split('/')[0])}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-medium text-gray-900 max-w-[120px] truncate\",children:file.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-[10px] text-gray-500\",children:[(file.size/1024).toFixed(1),\" KB\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFile(index),className:\"ml-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors\",title:\"Kald\\u0131r\",children:/*#__PURE__*/_jsx(X,{size:14})})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gradient-to-r from-gray-50 to-gray-100 border-t-2 border-gray-200 px-4 py-4\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"flex items-end gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",multiple:true,accept:\"image/*,video/*,audio/*,.pdf,.doc,.docx,.txt,.xlsx,.xls,.ppt,.pptx,.zip,.rar\",onChange:handleFileChange,className:\"hidden\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{var _fileInputRef$current;return(_fileInputRef$current=fileInputRef.current)===null||_fileInputRef$current===void 0?void 0:_fileInputRef$current.click();},className:\"flex-shrink-0 p-3 text-gray-600 hover:text-blue-600 bg-white hover:bg-blue-50 rounded-xl border border-gray-200 hover:border-blue-300 transition-all shadow-sm hover:shadow-md\",disabled:isSending,title:\"Dosya Ekle\",children:/*#__PURE__*/_jsx(Paperclip,{size:22})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 relative\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:messageText,onChange:e=>setMessageText(e.target.value),onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage(e);}},placeholder:\"Mesaj\\u0131n\\u0131z\\u0131 yaz\\u0131n... (Enter: G\\xF6nder, Shift+Enter: Yeni sat\\u0131r)\",className:\"w-full px-4 py-3 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none shadow-sm transition-all placeholder:text-gray-400\",rows:1,disabled:isSending,style:{minHeight:'48px',maxHeight:'120px'}}),messageText.trim()&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-2 right-2 text-xs text-gray-400\",children:[messageText.length,\" karakter\"]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isSending||!messageText.trim()&&mediaFiles.length===0,className:\"flex-shrink-0 p-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-500 group\",title:isSending?'Gönderiliyor...':'Gönder',children:isSending?/*#__PURE__*/_jsx(RefreshCw,{size:22,className:\"animate-spin\"}):/*#__PURE__*/_jsx(Send,{size:22,className:\"group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-transform\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-2 px-1\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 flex items-center gap-1\",children:[/*#__PURE__*/_jsx(MessageSquare,{size:12}),\"Enter ile h\\u0131zl\\u0131ca g\\xF6nderin\"]}),mediaFiles.length===0&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Paperclip,{size:12}),\"Dosya ekleyebilirsiniz\"]})]})]}),showAssignUsersModal&&channel&&user&&/*#__PURE__*/_jsx(AssignUsersModal,{channelId:channel.id,channelName:channel.name,brandId:channel.brand_id,currentAssignedUserIds:channel.assigned_user_ids||[],currentUserId:user.id,onClose:()=>setShowAssignUsersModal(false),onSuccess:()=>{loadAssignedUsers();loadChannel();}})]});};export default ChannelDetailOptimized;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useParams","useNavigate","useAuth","socialMediaChannelsAPI","ArrowLeft","RefreshCw","Users","MessageSquare","Send","Paperclip","X","Image","ImageIcon","Video","FileText","CheckCircle","XCircle","Trash2","Download","UserPlus","Building2","BarChart3","TrendingUp","Bot","toast","api","format","AssignUsersModal","jsx","_jsx","jsxs","_jsxs","ChannelDetailOptimized","_user$permissions","_user$permissions2","channelId","navigate","user","loading","authLoading","channel","setChannel","messages","setMessages","setLoading","showAssignUsersModal","setShowAssignUsersModal","assignedUsers","setAssignedUsers","statistics","setStatistics","botInfo","setBotInfo","assignedUsersStats","setAssignedUsersStats","showStats","setShowStats","messageText","setMessageText","mediaFiles","setMediaFiles","isSending","setIsSending","messagesEndRef","pollIntervalRef","fileInputRef","lastMessageCountRef","scrollToBottom","setTimeout","_messagesEndRef$curre","current","scrollIntoView","behavior","loadChannel","data","getChannel","Number","error","loadAssignedUsers","response","getChannelAssignedUsers","assigned_users","loadStatistics","get","concat","bot","console","loadMessages","silent","arguments","length","undefined","params","per_page","fetchedMessages","hasNewMessages","replace","setInterval","clearInterval","handleFileChange","e","target","files","Array","from","maxSize","oversizedFiles","filter","f","size","map","name","join","prev","success","removeFile","index","_","i","clearAllFiles","value","handleSendMessage","preventDefault","trim","textToSend","filesToSend","post","message_text","message_type","file","formData","FormData","append","headers","successCount","failCount","Promise","resolve","duration","_error$response","_error$response$data","errorMessage","detail","message","handleTelegramSync","handleClearMessages","window","confirm","id","delete","deleted_count","renderFileIcon","type","className","children","onClick","title","is_active","member_count","brand_name","permissions","includes","role","total_messages","sent_posts","total_members","assigned_users_count","username","is_verified","userStat","email","sent_messages","first_name","last_name","is_sent","is_sending","media_url","src","alt","file_name","open","controls","href","rel","Date","timestamp","ref","split","toFixed","onSubmit","multiple","accept","onChange","_fileInputRef$current","click","disabled","onKeyDown","key","shiftKey","placeholder","rows","style","minHeight","maxHeight","channelName","brandId","brand_id","currentAssignedUserIds","assigned_user_ids","currentUserId","onClose","onSuccess"],"sources":["C:/Users/ilker/Desktop/aibrands/frontend/src/pages/admin/ChannelDetailOptimized.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useAuth } from '../../hooks/useAuth';\nimport { socialMediaChannelsAPI, SocialMediaChannel } from '../../api/socialMediaChannels';\nimport { \n  ArrowLeft, RefreshCw, Users, MessageSquare, Send, \n  Paperclip, X, Image as ImageIcon, Video, FileText, \n  CheckCircle, XCircle, Trash2, Download, UserPlus, \n  Building2, BarChart3, TrendingUp, Bot\n} from 'lucide-react';\nimport toast from 'react-hot-toast';\nimport api from '../../utils/api';\nimport { format } from 'date-fns';\nimport { AssignUsersModal } from '../../components/channels/AssignUsersModal';\n\ninterface Message {\n  id: number;\n  message_text: string;\n  is_sent: boolean;\n  timestamp: string;\n  media_url?: string | null;\n  message_type?: string | null;\n  file_name?: string | null;\n  is_sending?: boolean;\n  temp_id?: number;\n}\n\ninterface ChannelStatistics {\n  total_messages: number;\n  sent_posts: number;\n  total_members: number;\n  assigned_users_count: number;\n}\n\ninterface BotInfo {\n  id: number;\n  name: string;\n  username: string;\n  is_active: boolean;\n  is_verified: boolean;\n}\n\ninterface AssignedUserStats {\n  id: number;\n  name: string;\n  email: string;\n  sent_messages: number;\n}\n\nconst ChannelDetailOptimized: React.FC = () => {\n  const { channelId } = useParams<{ channelId: string }>();\n  const navigate = useNavigate();\n  const { user, loading: authLoading } = useAuth();\n  \n  // State\n  const [channel, setChannel] = useState<SocialMediaChannel | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [showAssignUsersModal, setShowAssignUsersModal] = useState(false);\n  const [assignedUsers, setAssignedUsers] = useState<any[]>([]);\n  const [statistics, setStatistics] = useState<ChannelStatistics | null>(null);\n  const [botInfo, setBotInfo] = useState<BotInfo | null>(null);\n  const [assignedUsersStats, setAssignedUsersStats] = useState<AssignedUserStats[]>([]);\n  const [showStats, setShowStats] = useState(true);\n  \n  // Message input\n  const [messageText, setMessageText] = useState('');\n  const [mediaFiles, setMediaFiles] = useState<File[]>([]);\n  const [isSending, setIsSending] = useState(false);\n  \n  // Refs\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const pollIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const lastMessageCountRef = useRef<number>(0);\n\n  // Scroll to bottom\n  const scrollToBottom = useCallback(() => {\n    setTimeout(() => {\n      messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    }, 100);\n  }, []);\n\n  // Load channel\n  const loadChannel = useCallback(async () => {\n    if (!channelId) return;\n    \n    try {\n      const data = await socialMediaChannelsAPI.getChannel(Number(channelId));\n      setChannel(data);\n    } catch (error: any) {\n      toast.error('Kanal bilgileri yüklenemedi');\n      navigate('/admin/social-media/channels');\n    }\n  }, [channelId, navigate]);\n\n  // Load assigned users\n  const loadAssignedUsers = useCallback(async () => {\n    if (!channelId) return;\n    \n    try {\n      const response = await socialMediaChannelsAPI.getChannelAssignedUsers(Number(channelId));\n      setAssignedUsers(response.assigned_users || []);\n    } catch (error) {\n      // Silently handle error - assigned users are not critical\n    }\n  }, [channelId]);\n\n  // Load statistics\n  const loadStatistics = useCallback(async () => {\n    if (!channelId) return;\n    \n    try {\n      const response = await api.get(`/api/social-media/channels/${channelId}/statistics`);\n      setStatistics(response.data.statistics);\n      setBotInfo(response.data.bot);\n      setAssignedUsersStats(response.data.assigned_users || []);\n    } catch (error) {\n      console.error('Statistics load error:', error);\n    }\n  }, [channelId]);\n\n  // Load messages\n  const loadMessages = useCallback(async (silent = false) => {\n    if (!channelId) return;\n    \n    try {\n      if (!silent) setLoading(true);\n      \n      const response = await api.get(`/api/social-media/channels/${channelId}/messages`, {\n        params: { per_page: 500 }\n      });\n\n      const fetchedMessages: Message[] = response.data.messages || [];\n      \n      // Check for new messages\n      const hasNewMessages = fetchedMessages.length > lastMessageCountRef.current;\n      lastMessageCountRef.current = fetchedMessages.length;\n      \n      setMessages(fetchedMessages);\n      \n      // Auto-scroll on new messages\n      if (hasNewMessages) {\n        scrollToBottom();\n      }\n    } catch (error: any) {\n      if (!silent) toast.error('Mesajlar yüklenemedi');\n    } finally {\n      setLoading(false);\n    }\n  }, [channelId, scrollToBottom]);\n\n  // Initial load\n  useEffect(() => {\n    if (authLoading) return;\n    if (!user) {\n      navigate('/login', { replace: true });\n      return;\n    }\n    \n    loadChannel();\n    loadAssignedUsers();\n    loadMessages();\n    loadStatistics();\n  }, [authLoading, user, navigate, loadChannel, loadAssignedUsers, loadMessages, loadStatistics]);\n\n  // Real-time polling (every 3 seconds)\n  useEffect(() => {\n    if (!channelId) return;\n    \n    pollIntervalRef.current = setInterval(() => {\n      loadMessages(true);\n    }, 3000);\n\n    return () => {\n      if (pollIntervalRef.current) {\n        clearInterval(pollIntervalRef.current);\n      }\n    };\n  }, [channelId, loadMessages]);\n\n  // File handling\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files) return;\n    \n    const files = Array.from(e.target.files);\n    \n    // Dosya sayısı kontrolü\n    if (files.length + mediaFiles.length > 50) {\n      toast.error('En fazla 50 dosya ekleyebilirsiniz');\n      return;\n    }\n\n    // Dosya boyutu kontrolü (her dosya max 50MB)\n    const maxSize = 50 * 1024 * 1024; // 50MB\n    const oversizedFiles = files.filter(f => f.size > maxSize);\n    if (oversizedFiles.length > 0) {\n      toast.error(`Bazı dosyalar çok büyük (max 50MB): ${oversizedFiles.map(f => f.name).join(', ')}`);\n      return;\n    }\n\n    setMediaFiles(prev => [...prev, ...files]);\n    toast.success(`${files.length} dosya eklendi`);\n  };\n\n  const removeFile = (index: number) => {\n    setMediaFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const clearAllFiles = () => {\n    setMediaFiles([]);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Send message - TAM ÇALIŞIR VERSİYON\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Validasyon\n    if (!channelId) {\n      toast.error('Kanal ID bulunamadı');\n      return;\n    }\n    \n    if (!messageText.trim() && mediaFiles.length === 0) {\n      toast.error('Lütfen mesaj yazın veya dosya ekleyin');\n      return;\n    }\n    \n    if (isSending) return;\n\n    setIsSending(true);\n    const textToSend = messageText.trim();\n    const filesToSend = [...mediaFiles];\n    \n    // Clear inputs immediately for better UX\n    setMessageText('');\n    clearAllFiles();\n\n    try {\n      // SENARYO 1: Sadece metin (dosya yok)\n      if (filesToSend.length === 0 && textToSend) {\n        await api.post(`/api/social-media/channels/${channelId}/messages`, {\n          message_text: textToSend,\n          message_type: 'text'\n        });\n        toast.success('✅ Mesaj gönderildi!');\n      }\n      \n      // SENARYO 2: Tek dosya + metin (opsiyonel)\n      else if (filesToSend.length === 1) {\n        const file = filesToSend[0];\n        const formData = new FormData();\n        formData.append('file', file);\n        if (textToSend) {\n          formData.append('message_text', textToSend);\n        }\n        \n        await api.post(\n          `/api/social-media/channels/${channelId}/messages/upload`,\n          formData,\n          {\n            headers: { 'Content-Type': 'multipart/form-data' }\n          }\n        );\n        toast.success(`✅ ${textToSend ? 'Mesaj ve dosya' : 'Dosya'} gönderildi!`);\n      }\n      \n      // SENARYO 3: Çoklu dosya + metin (opsiyonel)\n      else if (filesToSend.length > 1) {\n        let successCount = 0;\n        let failCount = 0;\n        \n        // İlk dosyaya metni ekle\n        for (let i = 0; i < filesToSend.length; i++) {\n          const file = filesToSend[i];\n          \n          try {\n            const formData = new FormData();\n            formData.append('file', file);\n            \n            // Sadece ilk dosyaya metin ekle\n            if (i === 0 && textToSend) {\n              formData.append('message_text', textToSend);\n            }\n            \n            await api.post(\n              `/api/social-media/channels/${channelId}/messages/upload`,\n              formData,\n              {\n                headers: { 'Content-Type': 'multipart/form-data' }\n              }\n            );\n            \n            successCount++;\n            \n            // Rate limiting: Her dosya arasında 500ms bekle\n            if (i < filesToSend.length - 1) {\n              await new Promise(resolve => setTimeout(resolve, 500));\n            }\n            \n          } catch (error: any) {\n            failCount++;\n            console.error(`Dosya gönderimi başarısız: ${file.name}`, error);\n            toast.error(`❌ ${file.name} gönderilemedi`, { duration: 2000 });\n          }\n        }\n        \n        // Özet mesaj\n        if (successCount > 0) {\n          toast.success(`✅ ${successCount}/${filesToSend.length} dosya gönderildi!`);\n        }\n        if (failCount > 0) {\n          toast.error(`⚠️ ${failCount} dosya gönderilemedi`);\n        }\n      }\n\n      // Mesajları yenile\n      setTimeout(() => {\n        loadMessages(true);\n        scrollToBottom();\n      }, 2000);\n\n    } catch (error: any) {\n      console.error('Mesaj gönderme hatası:', error);\n      const errorMessage = error?.response?.data?.detail || error.message || 'Mesaj gönderilemedi';\n      toast.error(`❌ ${errorMessage}`);\n      \n      // Hata durumunda girişleri geri yükle\n      if (textToSend) setMessageText(textToSend);\n      if (filesToSend.length > 0) setMediaFiles(filesToSend);\n      \n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  // Sync from Telegram\n  const handleTelegramSync = async () => {\n    try {\n      toast.loading('Telegram mesajları senkronize ediliyor...', { duration: 2000 });\n      await api.post(`/api/social-media/channels/${channelId}/sync-messages`);\n      toast.success('Mesajlar senkronize ediliyor');\n      setTimeout(() => loadMessages(true), 3000);\n    } catch (error) {\n      toast.error('Senkronizasyon başarısız');\n    }\n  };\n\n  // Clear all messages\n  const handleClearMessages = async () => {\n    if (!window.confirm('Tüm mesajları silmek istediğinizden emin misiniz?')) return;\n    \n    try {\n      toast.loading('Mesajlar temizleniyor...', { id: 'clear' });\n      const response = await api.delete(`/api/social-media/channels/${channelId}/messages/clear`);\n      setMessages([]);\n      lastMessageCountRef.current = 0;\n      toast.success(`✅ ${response.data.deleted_count} mesaj temizlendi!`, { id: 'clear' });\n    } catch (error: any) {\n      toast.error('Mesajlar temizlenemedi', { id: 'clear' });\n    }\n  };\n\n  // Render file icon\n  const renderFileIcon = (type?: string | null) => {\n    if (type === 'image') return <ImageIcon size={16} className=\"text-blue-500\" />;\n    if (type === 'video') return <Video size={16} className=\"text-purple-500\" />;\n    return <FileText size={16} className=\"text-gray-500\" />;\n  };\n\n  // Loading states\n  if (authLoading || loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\n      </div>\n    );\n  }\n\n  if (!channel) return null;\n\n  return (\n    <div className=\"flex flex-col h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-gray-50\">\n      {/* Header - Modern & Elegant */}\n      <div className=\"bg-white/80 backdrop-blur-sm border-b border-gray-200/50 shadow-sm\">\n        <div className=\"px-6 py-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-4\">\n              <button\n                onClick={() => navigate('/admin/telegram/channels')}\n                className=\"p-2.5 hover:bg-gray-100 rounded-xl transition-all hover:shadow-md group\"\n                title=\"Geri Dön\"\n              >\n                <ArrowLeft size={22} className=\"group-hover:-translate-x-0.5 transition-transform\" />\n              </button>\n              \n              <div>\n                <div className=\"flex items-center gap-3\">\n                  <h1 className=\"text-xl font-bold text-gray-900\">{channel.name}</h1>\n                  {channel.is_active ? (\n                    <span className=\"flex items-center gap-1.5 px-2.5 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium\">\n                      <CheckCircle size={14} />\n                      Aktif\n                    </span>\n                  ) : (\n                    <span className=\"flex items-center gap-1.5 px-2.5 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium\">\n                      <XCircle size={14} />\n                      Pasif\n                    </span>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-4 mt-1.5\">\n                  <span className=\"flex items-center gap-1.5 text-sm text-gray-600\">\n                    <MessageSquare size={14} className=\"text-blue-500\" />\n                    <span className=\"font-medium\">{messages.length}</span> mesaj\n                  </span>\n                  <span className=\"flex items-center gap-1.5 text-sm text-gray-600\">\n                    <Users size={14} className=\"text-purple-500\" />\n                    <span className=\"font-medium\">{channel.member_count || 0}</span> üye\n                  </span>\n                  <span className=\"flex items-center gap-1.5 text-sm text-gray-600\">\n                    <Building2 size={14} className=\"text-indigo-500\" />\n                    {channel.brand_name || 'Marka'}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={() => setShowStats(!showStats)}\n                className={`flex items-center gap-2 px-4 py-2.5 text-sm font-medium rounded-xl transition-all shadow-sm ${\n                  showStats \n                    ? 'bg-gradient-to-r from-indigo-500 to-indigo-600 text-white shadow-indigo-200' \n                    : 'bg-white text-gray-700 hover:bg-gray-50 border border-gray-200'\n                }`}\n                title=\"İstatistikleri Göster/Gizle\"\n              >\n                <BarChart3 size={16} />\n                İstatistikler\n              </button>\n\n              {(user?.permissions?.includes('social.manage') || user?.permissions?.includes('brands.manage')) && (\n                <button\n                  onClick={() => setShowAssignUsersModal(true)}\n                  className=\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl hover:from-purple-600 hover:to-purple-700 transition-all shadow-sm shadow-purple-200\"\n                  title=\"Kullanıcı Yönet\"\n                >\n                  <UserPlus size={16} />\n                  Kullanıcı ({assignedUsers.length})\n                </button>\n              )}\n\n              <button\n                onClick={handleTelegramSync}\n                className=\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium bg-white text-blue-600 border border-blue-200 rounded-xl hover:bg-blue-50 transition-all shadow-sm\"\n                title=\"Telegram'dan Mesajları Çek\"\n              >\n                <RefreshCw size={16} />\n                Sync\n              </button>\n\n              {(user?.role === 'Super Admin' || user?.role === 'Mağaza Yöneticisi') && messages.length > 0 && (\n                <button\n                  onClick={handleClearMessages}\n                  className=\"flex items-center gap-2 px-4 py-2.5 text-sm font-medium bg-white text-red-600 border border-red-200 rounded-xl hover:bg-red-50 transition-all shadow-sm\"\n                  title=\"Tüm mesajları temizle\"\n                >\n                  <Trash2 size={16} />\n                  Temizle\n                </button>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Statistics Panel - Toggle */}\n      {showStats && statistics && (\n        <div className=\"bg-white border-b border-gray-200 px-4 py-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-4 mb-4\">\n            {/* Stat Card 1: Total Messages */}\n            <div className=\"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl border border-blue-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs font-medium text-blue-600 mb-1\">Toplam Mesaj</p>\n                  <p className=\"text-2xl font-bold text-blue-900\">{statistics.total_messages}</p>\n                </div>\n                <MessageSquare className=\"text-blue-500\" size={32} />\n              </div>\n            </div>\n\n            {/* Stat Card 2: Sent Posts */}\n            <div className=\"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl border border-green-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs font-medium text-green-600 mb-1\">Gönderilen Post</p>\n                  <p className=\"text-2xl font-bold text-green-900\">{statistics.sent_posts}</p>\n                </div>\n                <Send className=\"text-green-500\" size={32} />\n              </div>\n            </div>\n\n            {/* Stat Card 3: Total Members */}\n            <div className=\"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-xl border border-purple-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs font-medium text-purple-600 mb-1\">Toplam Üye</p>\n                  <p className=\"text-2xl font-bold text-purple-900\">{statistics.total_members}</p>\n                </div>\n                <Users className=\"text-purple-500\" size={32} />\n              </div>\n            </div>\n\n            {/* Stat Card 4: Assigned Users */}\n            <div className=\"bg-gradient-to-br from-orange-50 to-orange-100 p-4 rounded-xl border border-orange-200\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs font-medium text-orange-600 mb-1\">Atanmış Çalışan</p>\n                  <p className=\"text-2xl font-bold text-orange-900\">{statistics.assigned_users_count}</p>\n                </div>\n                <UserPlus className=\"text-orange-500\" size={32} />\n              </div>\n            </div>\n          </div>\n\n          {/* Bot Info */}\n          {botInfo && (\n            <div className=\"bg-gradient-to-br from-indigo-50 to-indigo-100 p-4 rounded-xl border border-indigo-200 mb-4\">\n              <div className=\"flex items-center gap-3\">\n                <Bot className=\"text-indigo-600\" size={28} />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-indigo-900\">{botInfo.name}</p>\n                  <p className=\"text-xs text-indigo-600\">{botInfo.username}</p>\n                </div>\n                <div className=\"flex gap-2\">\n                  {botInfo.is_active && (\n                    <span className=\"px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full flex items-center gap-1\">\n                      <CheckCircle size={12} />\n                      Aktif\n                    </span>\n                  )}\n                  {botInfo.is_verified && (\n                    <span className=\"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full flex items-center gap-1\">\n                      <CheckCircle size={12} />\n                      Doğrulanmış\n                    </span>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Employee Performance Table */}\n          {assignedUsersStats.length > 0 && (\n            <div className=\"bg-white rounded-xl border border-gray-200 overflow-hidden\">\n              <div className=\"bg-gray-50 px-4 py-3 border-b border-gray-200\">\n                <h3 className=\"text-sm font-semibold text-gray-900 flex items-center gap-2\">\n                  <TrendingUp size={16} className=\"text-gray-600\" />\n                  Çalışan Performansı\n                </h3>\n              </div>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead className=\"bg-gray-50 border-b border-gray-200\">\n                    <tr>\n                      <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-600\">Çalışan</th>\n                      <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-600\">Email</th>\n                      <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-600\">Gönderilen Post</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-gray-200\">\n                    {assignedUsersStats.map((userStat) => (\n                      <tr key={userStat.id} className=\"hover:bg-gray-50 transition-colors\">\n                        <td className=\"px-4 py-3 text-sm text-gray-900 font-medium\">{userStat.name}</td>\n                        <td className=\"px-4 py-3 text-sm text-gray-600\">{userStat.email}</td>\n                        <td className=\"px-4 py-3 text-sm text-right\">\n                          <span className=\"inline-flex items-center justify-center px-3 py-1 bg-blue-100 text-blue-700 rounded-full font-semibold\">\n                            {userStat.sent_messages}\n                          </span>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Assigned Users Display */}\n      {assignedUsers.length > 0 && (\n        <div className=\"bg-gray-50 border-b border-gray-200 px-4 py-2\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-xs text-gray-600\">Atanan Kullanıcılar:</span>\n            <div className=\"flex flex-wrap gap-1\">\n              {assignedUsers.map((user: any) => (\n                <span\n                  key={user.id}\n                  className=\"inline-flex items-center gap-1 px-2 py-0.5 bg-white rounded-full border border-gray-200 text-xs text-gray-700\"\n                >\n                  <Users size={10} />\n                  {user.first_name} {user.last_name}\n                </span>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Messages Area - Modern Chat Design */}\n      <div className=\"flex-1 overflow-y-auto px-6 py-6 space-y-3\">\n        {messages.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full\">\n            <div className=\"p-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl shadow-sm\">\n              <MessageSquare size={56} className=\"mb-4 text-blue-400 mx-auto\" />\n              <p className=\"text-base font-medium text-gray-700 mb-1\">Henüz mesaj yok</p>\n              <p className=\"text-sm text-gray-500\">Aşağıdan ilk mesajınızı gönderin</p>\n            </div>\n          </div>\n        ) : (\n          messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex ${message.is_sent ? 'justify-end' : 'justify-start'} animate-fadeIn`}\n            >\n              <div\n                className={`max-w-[70%] rounded-2xl px-4 py-3 shadow-sm ${\n                  message.is_sent\n                    ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white'\n                    : 'bg-white border border-gray-200 text-gray-900'\n                } ${message.is_sending ? 'opacity-60 animate-pulse' : ''}`}\n              >\n                {/* Media */}\n                {message.media_url && (\n                  <div className=\"mb-2\">\n                    {message.message_type === 'image' && (\n                      <img\n                        src={message.media_url}\n                        alt={message.file_name || 'Image'}\n                        className=\"max-w-full max-h-64 rounded-xl cursor-pointer hover:opacity-90 transition-opacity\"\n                        onClick={() => window.open(message.media_url!, '_blank')}\n                      />\n                    )}\n                    {message.message_type === 'video' && (\n                      <video\n                        src={message.media_url}\n                        controls\n                        className=\"max-w-full max-h-64 rounded-xl\"\n                      />\n                    )}\n                    {message.message_type === 'document' && (\n                      <a\n                        href={message.media_url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"flex items-center gap-2 text-sm hover:underline\"\n                      >\n                        <Download size={14} />\n                        {message.file_name || 'Dosya'}\n                      </a>\n                    )}\n                  </div>\n                )}\n\n                {/* Text */}\n                {message.message_text && (\n                  <p className=\"text-sm break-words\">{message.message_text}</p>\n                )}\n\n                {/* Timestamp */}\n                <div className={`text-xs mt-1 ${message.is_sent ? 'text-blue-100' : 'text-gray-400'}`}>\n                  {format(new Date(message.timestamp), 'HH:mm')}\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* File Previews - Modern Design */}\n      {mediaFiles.length > 0 && (\n        <div className=\"px-4 py-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-t border-blue-100\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <div className=\"flex items-center gap-2\">\n              <Paperclip size={16} className=\"text-blue-600\" />\n              <span className=\"text-sm font-medium text-blue-900\">{mediaFiles.length} dosya seçildi</span>\n            </div>\n            <button\n              onClick={clearAllFiles}\n              className=\"text-xs text-red-600 hover:text-red-700 font-medium flex items-center gap-1 hover:underline\"\n            >\n              <X size={14} />\n              Tümünü Kaldır\n            </button>\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            {mediaFiles.map((file, index) => (\n              <div\n                key={index}\n                className=\"group relative flex items-center gap-2 px-3 py-2 bg-white rounded-lg border border-blue-200 shadow-sm hover:shadow-md transition-all\"\n              >\n                <div className=\"p-1.5 bg-blue-100 rounded\">\n                  {renderFileIcon(file.type.split('/')[0])}\n                </div>\n                <div className=\"flex flex-col\">\n                  <span className=\"text-xs font-medium text-gray-900 max-w-[120px] truncate\">{file.name}</span>\n                  <span className=\"text-[10px] text-gray-500\">{(file.size / 1024).toFixed(1)} KB</span>\n                </div>\n                <button\n                  onClick={() => removeFile(index)}\n                  className=\"ml-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition-colors\"\n                  title=\"Kaldır\"\n                >\n                  <X size={14} />\n                </button>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Input Area - Modern & Beautiful */}\n      <div className=\"bg-gradient-to-r from-gray-50 to-gray-100 border-t-2 border-gray-200 px-4 py-4\">\n        <form onSubmit={handleSendMessage} className=\"flex items-end gap-3\">\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            accept=\"image/*,video/*,audio/*,.pdf,.doc,.docx,.txt,.xlsx,.xls,.ppt,.pptx,.zip,.rar\"\n            onChange={handleFileChange}\n            className=\"hidden\"\n          />\n\n          {/* Attachment Button */}\n          <button\n            type=\"button\"\n            onClick={() => fileInputRef.current?.click()}\n            className=\"flex-shrink-0 p-3 text-gray-600 hover:text-blue-600 bg-white hover:bg-blue-50 rounded-xl border border-gray-200 hover:border-blue-300 transition-all shadow-sm hover:shadow-md\"\n            disabled={isSending}\n            title=\"Dosya Ekle\"\n          >\n            <Paperclip size={22} />\n          </button>\n\n          {/* Message Input */}\n          <div className=\"flex-1 relative\">\n            <textarea\n              value={messageText}\n              onChange={(e) => setMessageText(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' && !e.shiftKey) {\n                  e.preventDefault();\n                  handleSendMessage(e);\n                }\n              }}\n              placeholder=\"Mesajınızı yazın... (Enter: Gönder, Shift+Enter: Yeni satır)\"\n              className=\"w-full px-4 py-3 bg-white border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none shadow-sm transition-all placeholder:text-gray-400\"\n              rows={1}\n              disabled={isSending}\n              style={{ minHeight: '48px', maxHeight: '120px' }}\n            />\n            {messageText.trim() && (\n              <div className=\"absolute bottom-2 right-2 text-xs text-gray-400\">\n                {messageText.length} karakter\n              </div>\n            )}\n          </div>\n\n          {/* Send Button */}\n          <button\n            type=\"submit\"\n            disabled={isSending || (!messageText.trim() && mediaFiles.length === 0)}\n            className=\"flex-shrink-0 p-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-500 group\"\n            title={isSending ? 'Gönderiliyor...' : 'Gönder'}\n          >\n            {isSending ? (\n              <RefreshCw size={22} className=\"animate-spin\" />\n            ) : (\n              <Send size={22} className=\"group-hover:translate-x-0.5 group-hover:-translate-y-0.5 transition-transform\" />\n            )}\n          </button>\n        </form>\n        \n        {/* Helper Text */}\n        <div className=\"flex items-center justify-between mt-2 px-1\">\n          <p className=\"text-xs text-gray-500 flex items-center gap-1\">\n            <MessageSquare size={12} />\n            Enter ile hızlıca gönderin\n          </p>\n          {mediaFiles.length === 0 && (\n            <p className=\"text-xs text-gray-500 flex items-center gap-1\">\n              <Paperclip size={12} />\n              Dosya ekleyebilirsiniz\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Assign Users Modal */}\n      {showAssignUsersModal && channel && user && (\n        <AssignUsersModal\n          channelId={channel.id}\n          channelName={channel.name}\n          brandId={channel.brand_id}\n          currentAssignedUserIds={channel.assigned_user_ids || []}\n          currentUserId={user.id}\n          onClose={() => setShowAssignUsersModal(false)}\n          onSuccess={() => {\n            loadAssignedUsers();\n            loadChannel();\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ChannelDetailOptimized;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}